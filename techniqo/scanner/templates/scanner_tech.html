{% extends 'home.html' %}

{% block title %}Technical Custom Scanner{% endblock %}

{% block style %}
{% load static %}

{% endblock %}

{% block body %}
{% load static %}
<div class="container">
    <div class="row">
        <div class="col-7">

    <h1>Welcome to Technical Screener </h1>


    <div id="bm">
      <input type="hidden" name="backe" value="" class="backe">
    </div>
    <form class="formbackkk" name="prk" action="techscreen/" method="post">{% csrf_token %}

<div id="template" style="display: none;">
  <div class="one">
    <br><select class="indicators" name="indicators" id="onee">
            <option value="">--Chose indicator--</option>
            <option value="clo">Close</option>
            <option value="rsi">RSI(14)</option>
            <option value="macd">MACD Line(12,26,9)</option>
            <option value="mfi">Money Flow Index(14)</option>
            <option value="roc">ROC(9)</option>
            <option value="wil">Williams %R(14)</option>
            <option value="sma10">SMA(10)</option>
            <option value="sma20">SMA(20)</option>
            <option value="sma50">SMA(50)</option>
            <option value="sma100">SMA(100)</option>
            <option value="sma200">SMA(200)</option>
            <option value="ema10">EMA(10)</option>
            <option value="ema20">EMA(20)</option>
            <option value="ema50">EMA(50)</option>
            <option value="ema100">EMA(100)</option>
            <option value="ema200">EMA(200)</option>
            <option value="cl">Conversion Line (Ichimoku Cloud)</option>
            <option value="ls">Lag Span (Ichimoku Cloud)</option>
            <option value="srsi">Fast Line (Stochastic RSI(14))</option>
        </select><br>
  </div>
</div>

<div id="submm" style="display: none;">
  <button type="button" name="formbackk" class="formbackk btn btn-dark">Backtest</button>
</div>


<div class="rsi_v" style="display: none;">
  <div class="row paramaccor">

    <br><select class='parameters ml-3 mt-2' name='parameters'>
      <option value="">--Choose Parameters--</option>
      <option value='crossover'>Crossing over</option>
      <option value='crossunder'>Crossing under</option>
      <option value='above'>Above</option>
      <option value='below'>Below</option>
   </select>

    <input type="text" name="rsi_value" value="" placeholder="Enter Value" class="values ml-3 mt-2">

    <button type="button" name="remove" class="remove btn btn-dark ml-3 mt-2">Remove</button>

</div>
</div>

<div class="mfi_v" style="display: none;">
  <div class="row paramaccor">

    <br><select class='parameters ml-3 mt-2' name='parameters'>
      <option value="">--Choose Parameters--</option>
      <option value='crossover'>Crossing over</option>
      <option value='crossunder'>Crossing under</option>
      <option value='above'>Above</option>
      <option value='below'>Below</option>
   </select>

    <input type="text" name="rsi_value" value="" placeholder="Enter Value" class="values ml-3 mt-2">

    <button type="button" name="remove" class="remove btn btn-dark ml-3 mt-2">Remove</button>

</div>
</div>

<div class="roc_v" style="display: none;">
  <div class="row paramaccor">

    <br><select class='parameters ml-3 mt-2' name='parameters'>
      <option value="">--Choose Parameters--</option>
      <option value='crossover'>Crossing over</option>
      <option value='crossunder'>Crossing under</option>
      <option value='above'>Above</option>
      <option value='below'>Below</option>
   </select>

    <input type="text" name="rsi_value" value="" placeholder="Enter Value" class="values ml-3 mt-2">

    <button type="button" name="remove" class="remove btn btn-dark ml-3 mt-2">Remove</button>

</div>
</div>

<div class="bb_v" style="display: none;">
      <div class="row paramaccor">

        <br><select class='parameters ml-3 mt-2' name='parameters'>
          <option value=''>--Choose Parameters--</option>
          <option value='crossover'>Crossing over</option>
          <option value='crossunder'>Crossing under</option>
          <option value='above'>Above</option>
          <option value='below'>Below</option>
       </select>

        <select class='values ml-3 mt-2' name='values'>
          <option value=''>--Choose Entry Points--</option>
          <option value='lb'>Lower Band</option>
          <option value='mb'>Middle Band</option>
          <option value='up'>Upper Band</option>
       </select>

          <button type="button" name="remove" class="remove btn btn-dark ml-3 mt-2">Remove</button>

    </div>
</div>

<div class="sma_v" style="display: none;">
      <div class="row paramaccor">

        <br><select class='parameters ml-3 mt-2' name='parameters'>
          <option value=''>--Choose Parameters--</option>
          <option value='crossover'>Crossing over</option>
          <option value='crossunder'>Crossing under</option>
          <option value='above'>Above</option>
          <option value='below'>Below</option>
       </select>

        <select class='values ml-3 mt-2' name='values'>
            <option value=''>--Choose Entry Points--</option>
            <option value="sma10">SMA(10)</option>
            <option value="sma20">SMA(20)</option>
            <option value="sma50">SMA(50)</option>
            <option value="sma100">SMA(100)</option>
            <option value="sma200">SMA(200)</option>
       </select>

          <button type="button" name="remove" class="remove btn btn-dark ml-3 mt-2">Remove</button>

    </div>
</div>

<div class="ema_v" style="display: none;">
      <div class="row paramaccor">

        <br><select class='parameters ml-3 mt-2' name='parameters'>
          <option value=''>--Choose Parameters--</option>
          <option value='crossover'>Crossing over</option>
          <option value='crossunder'>Crossing under</option>
          <option value='above'>Above</option>
          <option value='below'>Below</option>
       </select>

        <select class='values ml-3 mt-2' name='values'>
            <option value=''>--Choose Entry Points--</option>
            <option value="ema10">EMA(10)</option>
            <option value="ema20">EMA(20)</option>
            <option value="ema50">EMA(50)</option>
            <option value="ema100">EMA(100)</option>
            <option value="ema200">EMA(200)</option>
       </select>

          <button type="button" name="remove" class="remove btn btn-dark ml-3 mt-2">Remove</button>

    </div>
</div>

<div class="clo_v" style="display: none;">
      <div class="row paramaccor">

        <br><select class='parameters ml-3 mt-2' name='parameters'>
          <option value=''>--Choose Parameters--</option>
          <option value='crossover'>Crossing over</option>
          <option value='crossunder'>Crossing under</option>
          <option value='above'>Above</option>
          <option value='below'>Below</option>
       </select>

        <select class='values ml-3 mt-2' name='values'>
            <option value=''>--Choose Entry Points--</option>
            <option value='lb'>Lower Band</option>
            <option value='mb'>Middle Band</option>
            <option value='up'>Upper Band</option>
            <option value="pp">Pivot Point</option>
            <option value="s1">Support 1</option>
            <option value="s2">Support 2</option>
            <option value="s3">Support 3</option>
            <option value="r1">Resistance 1</option>
            <option value="r2">Resistance 2</option>
            <option value="r3">Resistance 3</option>
            <option value="sma10">SMA(10)</option>
            <option value="sma20">SMA(20)</option>
            <option value="sma50">SMA(50)</option>
            <option value="sma100">SMA(100)</option>
            <option value="sma200">SMA(200)</option>
            <option value="ls">Lag Span</option>
            <option value="gc">Green Cloud</option>
            <option value="rc">Red Cloud</option>
            <option value="cl">Conversion Line</option>
            <option value="bl">Base Line</option>
            <option value="ema10">EMA(10)</option>
            <option value="ema20">EMA(20)</option>
            <option value="ema50">EMA(50)</option>
            <option value="ema100">EMA(100)</option>
            <option value="ema200">EMA(200)</option>
       </select>

          <button type="button" name="remove" class="remove btn btn-dark ml-3 mt-2">Remove</button>

    </div>
</div>

<div class="index_v">
    <h2 class="mt-2 si">Select Index</h2>
    <div class="index_va">
        <br><select class='index_values ml-3' name='values'>
            <option value=''>--Choose Index--</option>
            <option value="nifty_50">Nifty 50</option>
            <option value="nifty_next_50">Nifty Next 50</option>
            <option value="nifty_100">Nifty 100</option>
            <option value="nifty_200">Nifty 200</option>
            <option value="nifty_500">Nifty 500</option>
            <option value="midcap_50">Nifty Midcap 50</option>
            <option value="midcap_100">Nifty Midcap 100</option>
            <option value="midcap_150">Nifty Midcap 150</option>
            <option value="smallcap_50">Nifty Smallcap 50</option>
            <option value="smallcap_100">Nifty Smallcap 100</option>
            <option value="smallcap_250">Nifty Smallcap 250</option>
       </select>
    </div>
</div>

<div class="ic_v" style="display: none;">
      <div class="row paramaccor">

        <br><select class='parameters ml-3 mt-2' name='parameters'>
          <option value=''>--Choose Parameters--</option>
          <option value='crossover'>Crossing over</option>
          <option value='crossunder'>Crossing under</option>
          <option value='above'>Above</option>
          <option value='below'>Below</option>
       </select>

        <select class='values ml-3 mt-2' name='values'>
            <option value=''>--Choose Entry Points--</option>
            <option value="ls">Lag Span</option>
            <option value="gc">Green Cloud</option>
            <option value="rc">Red Cloud</option>
            <option value="cl">Conversion Line</option>
            <option value="bl">Base Line</option>
       </select>

          <button type="button" name="remove" class="remove btn btn-dark ml-3 mt-2">Remove</button>

    </div>
</div>

<div class="srsi_v" style="display: none;">
  <div class="row paramaccor">

    <br><select class='parameters ml-3 mt-2' name='parameters'>
      <option value="">--Choose Parameters--</option>
      <option value='crossover'>Crossing over</option>
      <option value='crossunder'>Crossing under</option>
      <option value='above'>Above</option>
      <option value='below'>Below</option>
   </select>

      <select class='values ml-3 mt-2' name='values'>
          <option value=''>--Choose Entry Points--</option>
          <option value='slow'>Slow Line</option>
          <option value='num'>0</option>
          <option value='num'>10</option>
          <option value='num'>20</option>
          <option value='num'>30</option>
          <option value='num'>40</option>
          <option value='num'>50</option>
          <option value='num'>60</option>
          <option value='num'>70</option>
          <option value='num'>80</option>
          <option value='num'>90</option>
          <option value='num'>100</option>
       </select>

</div>
</div>

<div class="macd_v" style="display: none;">
      <div class="row paramaccor">

        <br><select class='parameters ml-3 mt-2' name='parameters'>
          <option value=''>--Choose Parameters--</option>
          <option value='crossover'>Crossing over</option>
          <option value='crossunder'>Crossing under</option>
          <option value='above'>Above</option>
          <option value='below'>Below</option>
       </select>

        <select class='values ml-3 mt-2' name='values'>
          <option value=''>--Choose Entry Points--</option>
          <option value='sig'>Signal Line</option>
          <option value='zero'>Zero Line</option>
       </select>

          <button type="button" name="remove" class="remove btn btn-dark ml-3 mt-2">Remove</button>

    </div>
</div>


<div class="rows">
<div class="one" id="isko">
  <h1>Select Parameters</h1>
  <select class="indicators" name="indicators" id="onpee">
    <option value="">--Chose indicator--</option>
    <option value="clo">Close</option>
    <option value="rsi">RSI(14)</option>
    <option value="macd">MACD Line(12,26,9)</option>
    <option value="mfi">Money Flow Index(14)</option>
    <option value="roc">ROC(9)</option>
    <option value="wil">Williams %R(14)</option>
    <option value="sma10">SMA(10)</option>
    <option value="sma20">SMA(20)</option>
    <option value="sma50">SMA(50)</option>
    <option value="sma100">SMA(100)</option>
    <option value="sma200">SMA(200)</option>
    <option value="ema10">EMA(10)</option>
    <option value="ema20">EMA(20)</option>
    <option value="ema50">EMA(50)</option>
    <option value="ema100">EMA(100)</option>
    <option value="ema200">EMA(200)</option>
    <option value="cl">Conversion Line (Ichimoku Cloud)</option>
    <option value="ls">Lag Span (Ichimoku Cloud)</option>
    <option value="srsi">Fast Line (Stochastic RSI(14))</option>
  </select>
</div>

</div>
<div class="addc">
  <br><button type="button" name="add" id="add" class="btn btn-dark">ADD</button><br><br>
</div>
    <button type="button" name="entry_rule" id="entry_rule" class="btn btn-dark">Submit</button><br><br>

</form>
        </div>
        <div class="col-5">
            <img src="{% static 'backimg.png' %}" style="height: 500px;width: 500px; margin-right:25px;">
        </div>
    </div>
</div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script>
      $(document).ready(function(){
        var a = "";
        var b = "";
        var c = "";
        var d = "";
        var sec = 11;
        var pop_indi = 0;
        var seperator = 0;
        var count = 1;
        var check = "";
        var final = 0;
        var loso = "";

        $("#isko").hide();
        $(".addc").hide();
        $("#entry_rule").hide();
        $(".index_values").change(function(){
            d = $(this).val();
            $("#isko").show();
            $(".addc").show();
            $("#entry_rule").show();
            $(".index_va").hide();
            $(".si").hide();
        });



        $(".rows").on('change','.indicators:last',function(){
          check = $(".indicators:last").val();
          //a += $(".indicators:last").val() + ",";
          //console.log(check);
          if(check == "rsi" || check=="wil"){
          pop_indi = pop_indi +1;
              if(pop_indi > 1){
                $('.paramaccor').last().remove();
              }

          $(".rows:last").append($('.rsi_v').html());
          b = $(".parameters:last").val() + ",";
         }
          else if(check == "bb"){
            pop_indi = pop_indi +1;
            if(pop_indi > 1){
              $('.paramaccor').last().remove();
            }

            $(".rows:last").append($('.bb_v').html());
            b = $(".parameters:last").val() + ",";
          }
          else if(check == "macd"){
            pop_indi = pop_indi +1;
            if(pop_indi > 1){
              $('.paramaccor').last().remove();
            }

            $(".rows:last").append($('.macd_v').html());
            b = $(".parameters:last").val() + ",";
          }
          else if(check == "mfi"){
            pop_indi = pop_indi +1;
            if(pop_indi > 1){
              $('.paramaccor').last().remove();
            }

            $(".rows:last").append($('.mfi_v').html());
            b = $(".parameters:last").val() + ",";
          }
          else if(check == "roc"){
            pop_indi = pop_indi +1;
            if(pop_indi > 1){
              $('.paramaccor').last().remove();
            }

            $(".rows:last").append($('.roc_v').html());
            b = $(".parameters:last").val() + ",";
          }
          else if(check == "sma10" || check == "sma20" || check == "sma50" || check == "sma100" || check == "sma200"){
            pop_indi = pop_indi +1;
            if(pop_indi > 1){
              $('.paramaccor').last().remove();
            }

            $(".rows:last").append($('.sma_v').html());
            b = $(".parameters:last").val() + ",";
          }
          else if(check == "ema10" || check == "ema20" || check == "ema50" || check == "ema100" || check == "ema200"){
            pop_indi = pop_indi +1;
            if(pop_indi > 1){
              $('.paramaccor').last().remove();
            }

            $(".rows:last").append($('.ema_v').html());
            b = $(".parameters:last").val() + ",";
          }
          else if(check == "ls" || check == "cl"){
            pop_indi = pop_indi +1;
            if(pop_indi > 1){
              $('.paramaccor').last().remove();
            }

            $(".rows:last").append($('.ic_v').html());
            b = $(".parameters:last").val() + ",";
          }
          else if(check == "srsi"){
            pop_indi = pop_indi +1;
            if(pop_indi > 1){
              $('.paramaccor').last().remove();
            }

            $(".rows:last").append($('.srsi_v').html());
            b = $(".parameters:last").val() + ",";
          }
          else if(check == "clo"){
            pop_indi = pop_indi +1;
            if(pop_indi > 1){
              $('.paramaccor').last().remove();
            }

            $(".rows:last").append($('.clo_v').html());
            b = $(".parameters:last").val() + ",";
          }
        });

        $("#add").click(function(){
          count += 1;
          var ee = $("#entry_rule").length
          pop_indi = 0;
          var num = $(".one").length
          var num2 = $(".row").length
          if(num > 1){
          $(".indicators:last").prop('disabled',true);}
          if(num2 > 9){
          //jitne indicators add karega uss hisab se change hoga idhar 2 hai
          //bcoz rsi_v and bb_v
          $(".parameters:last").prop('disabled',true);
          $(".values:last").prop('disabled',true);}
          $(".rows:last").append($('#template').html());
        });

        $(document).on('click','.remove', function(){
          $(this).parent().prev().remove();
           $(this).closest('.row').remove();
           count = count - 1;
        });

        /*$("#entry_rule").click(function(){
            seperator = count;

            $(this).remove();
            pop_indi = 0;
            var num = $(".one").length
            var num2 = $(".row").length
            if(num > 1){
            $(".indicators:last").prop('disabled',true);}
            if(num2 > 10){
            //jitne indicators add karega uss hisab se change hoga idhar 2 hai
            //bcoz rsi_v and bb_v
            $(".parameters:last").prop('disabled',true);
            $(".values:last").prop('disabled',true);}
            $(".rows:last").append($('#template').html());
            $(".addc").append($('.spls').html());
            $(".addc").append($('#submm').html());
        });*/

        /*$(".addc").on('click','#stploss',function(){
          console.log("hi");
          pop_indi = 0;
          var num = $(".one").length
          var num2 = $(".row").length
          if(num > 1){
          $(".indicators:last").prop('disabled',true);}
          if(num2 > 10){
          //jitne indicators add karega uss hisab se change hoga idhar 2 hai
          //bcoz rsi_v and bb_v
          $(".parameters:last").prop('disabled',true);
          $(".values:last").prop('disabled',true);}
          $(".addc").prepend($('.after_stp_loss').html());
          for(var i=0;i<3;i++){
            $(this).prev().remove();
          }
          $(this).remove();

        });*/

        $("#entry_rule").click(function(){

          $(".indicators").each(function(){
            if($(this).val() !== ""){
              final += 1;
            a += $(this).val() + ",";
            if(final == seperator){
              a += "!!";
            }}
          })
          final = 0;
          $(".parameters").each(function(){
            if($(this).val() !== ""){
              final += 1;
            b += $(this).val() + ",";
            if(final == seperator){
              b += "!!";
            }}
          })
          final = 0;
          $(".values").each(function(){
            if($(this).val() !== ""){
              final += 1;
            c += $(this).val() + ",";
            if(final == seperator){
              c += "!!";
            }}
          })
          console.log(a+"||"+b+"||"+c+"||"+d)
          $(".rows:last").append($('#bm').html());
          $(".backe:last").attr("value",a+"||"+b+"||"+c+"||"+d);
          $(".formbackkk").submit();
        });

})



</script>

{% endblock %}

